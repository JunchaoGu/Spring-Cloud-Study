package com.xidian.chatservice;

import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.extern.slf4j.Slf4j;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.web.servlet.mvc.method.annotation.SseEmitter;

import java.io.IOException;

/**
 * SseEmitter ç»¼åˆæµ‹è¯•ç±»
 * 
 * ============================================
 * ğŸ“‹ æµ‹è¯•éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªå®æ—¶é€šçŸ¥ç³»ç»Ÿ
 * ============================================
 * 
 * åœºæ™¯æè¿°ï¼š
 * ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®æ—¶é€šçŸ¥ç³»ç»Ÿï¼Œéœ€è¦å‘ç”¨æˆ·æ¨é€ä¸åŒç±»å‹çš„é€šçŸ¥ã€‚
 * ç³»ç»Ÿéœ€è¦æ”¯æŒï¼š
 * 1. å‘é€æ–‡æœ¬é€šçŸ¥
 * 2. å‘é€ JSON æ ¼å¼çš„ç»“æ„åŒ–é€šçŸ¥
 * 3. æµå¼æ¨é€é•¿æ–‡æœ¬ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
 * 4. å¤„ç†è¿æ¥è¶…æ—¶
 * 5. å¤„ç†è¿æ¥é”™è¯¯
 * 6. æ‰¹é‡å‘é€å¤šæ¡é€šçŸ¥
 * 
 * ============================================
 * ğŸ¯ ä½ çš„ä»»åŠ¡ï¼š
 * ============================================
 * è¯·æ ¹æ®ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚
 * æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜å’Œæç¤ºï¼Œè¯·æŒ‰ç…§è¦æ±‚å®Œæˆã€‚
 * 
 * ============================================
 * âœ… è¯„åˆ†æ ‡å‡†ï¼š
 * ============================================
 * - æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼šä¼˜ç§€ â­â­â­â­â­
 * - 80% æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼šè‰¯å¥½ â­â­â­â­
 * - 60% æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼šåŠæ ¼ â­â­â­
 * - 60% ä»¥ä¸‹ï¼šéœ€è¦ç»§ç»­å­¦ä¹  â­â­
 * 
 * ============================================
 * ğŸ’¡ æç¤ºï¼š
 * ============================================
 * 1. ä»”ç»†é˜…è¯»æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¯´æ˜
 * 2. æ³¨æ„è¶…æ—¶æ—¶é—´çš„è®¾ç½®
 * 3. è®°å¾—è®¾ç½®å›è°ƒå‡½æ•°
 * 4. æ³¨æ„å¼‚å¸¸å¤„ç†
 * 5. å¯ä»¥å‚è€ƒä¹‹å‰çš„ç¤ºä¾‹ä»£ç 
 */
@Slf4j
@SpringBootTest
public class SseEmitterComprehensiveTest {

    private final ObjectMapper objectMapper = new ObjectMapper();

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 1ï¼šå‘é€å•æ¡æ–‡æœ¬é€šçŸ¥ï¼ˆåŸºç¡€é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 10 ç§’
     * 2. å‘é€ä¸€æ¡æ–‡æœ¬é€šçŸ¥ï¼š"æ¬¢è¿ä½¿ç”¨å®æ—¶é€šçŸ¥ç³»ç»Ÿï¼"
     * 3. æ­£å¸¸å…³é—­è¿æ¥
     * 
     * æç¤ºï¼š
     * - ä½¿ç”¨ new SseEmitter(è¶…æ—¶æ—¶é—´)
     * - ä½¿ç”¨ emitter.send() å‘é€æ¶ˆæ¯
     * - ä½¿ç”¨ emitter.complete() å…³é—­è¿æ¥
     */
    @Test
    public void test01_å‘é€å•æ¡æ–‡æœ¬é€šçŸ¥() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹1ï¼šå‘é€å•æ¡æ–‡æœ¬é€šçŸ¥ ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        // æç¤ºï¼šåˆ›å»º SseEmitterï¼Œå‘é€æ¶ˆæ¯ï¼Œå…³é—­è¿æ¥
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥ï¼ˆè¶…æ—¶æ—¶é—´ 10 ç§’ï¼‰
        // ä½ çš„ä»£ç ï¼š
        SseEmitter sseEmitter = new SseEmitter(10*1000L);
        
        // æ­¥éª¤2ï¼šå‘é€æ–‡æœ¬é€šçŸ¥
        // ä½ çš„ä»£ç ï¼š
        sseEmitter.send(SseEmitter.event().name("sendMessage").data("å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯"));
        
        // æ­¥éª¤3ï¼šå…³é—­è¿æ¥
        // ä½ çš„ä»£ç ï¼š
        sseEmitter.complete();
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹1å®Œæˆ");
        Thread.sleep(100); // ç­‰å¾…å›è°ƒæ‰§è¡Œ
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 2ï¼šå‘é€å¤šæ¡é€šçŸ¥ï¼ˆè¿›é˜¶é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 30 ç§’
     * 2. å‘é€ 5 æ¡é€šçŸ¥ï¼Œæ¯æ¡é—´éš” 500 æ¯«ç§’
     * 3. é€šçŸ¥å†…å®¹ï¼š
     *    - "é€šçŸ¥1ï¼šç³»ç»Ÿå¯åŠ¨æˆåŠŸ"
     *    - "é€šçŸ¥2ï¼šæ•°æ®åº“è¿æ¥æ­£å¸¸"
     *    - "é€šçŸ¥3ï¼šç¼“å­˜æœåŠ¡å°±ç»ª"
     *    - "é€šçŸ¥4ï¼šæ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸"
     *    - "é€šçŸ¥5ï¼šç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ"
     * 4. å‘é€å®Œæˆåå…³é—­è¿æ¥
     * 
     * æç¤ºï¼š
     * - ä½¿ç”¨å¾ªç¯å‘é€å¤šæ¡æ¶ˆæ¯
     * - ä½¿ç”¨ Thread.sleep() å®ç°é—´éš”
     */
    @Test
    public void test02_å‘é€å¤šæ¡é€šçŸ¥() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹2ï¼šå‘é€å¤šæ¡é€šçŸ¥ ==========");
        
        String[] notifications = {
            "é€šçŸ¥1ï¼šç³»ç»Ÿå¯åŠ¨æˆåŠŸ",
            "é€šçŸ¥2ï¼šæ•°æ®åº“è¿æ¥æ­£å¸¸",
            "é€šçŸ¥3ï¼šç¼“å­˜æœåŠ¡å°±ç»ª",
            "é€šçŸ¥4ï¼šæ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸",
            "é€šçŸ¥5ï¼šç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ"
        };
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥
        SseEmitter sseEmitter = new SseEmitter(30*1000L);
        
        // æ­¥éª¤2ï¼šå¾ªç¯å‘é€ 5 æ¡é€šçŸ¥ï¼Œæ¯æ¡é—´éš” 500 æ¯«ç§’
        for (int i = 0; i < notifications.length; i++) {

            sseEmitter.send(SseEmitter.event().name("sendMessage").data("å‘é€äº†"+i + notifications[i]));

            Thread.sleep(500);

        }
        
        // æ­¥éª¤3ï¼šå…³é—­è¿æ¥
        sseEmitter.complete();
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹2å®Œæˆ");
        Thread.sleep(100);
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 3ï¼šå‘é€ JSON æ ¼å¼çš„é€šçŸ¥ï¼ˆè¿›é˜¶é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 20 ç§’
     * 2. å‘é€ 3 æ¡ JSON æ ¼å¼çš„é€šçŸ¥
     * 3. JSON æ ¼å¼ï¼š
     *    {
     *      "type": "é€šçŸ¥ç±»å‹",
     *      "title": "é€šçŸ¥æ ‡é¢˜",
     *      "content": "é€šçŸ¥å†…å®¹",
     *      "timestamp": æ—¶é—´æˆ³
     *    }
     * 4. ä½¿ç”¨ ObjectMapper å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
     * 5. å‘é€å®Œæˆåå…³é—­è¿æ¥
     * 
     * æç¤ºï¼š
     * - åˆ›å»ºä¸€ä¸ª Notification ç±»ï¼ˆå·²æä¾›ï¼‰
     * - ä½¿ç”¨ objectMapper.writeValueAsString() è½¬æ¢ä¸º JSON
     */
    @Test
    public void test03_å‘é€JSONæ ¼å¼é€šçŸ¥() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹3ï¼šå‘é€ JSON æ ¼å¼é€šçŸ¥ ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥
        SseEmitter sseEmitter = new SseEmitter(20*1000L);
        
        // æ­¥éª¤2ï¼šåˆ›å»º 3 ä¸ª Notification å¯¹è±¡å¹¶å‘é€
        // é€šçŸ¥1ï¼štype="info", title="ç³»ç»Ÿæ¶ˆæ¯", content="ç³»ç»Ÿè¿è¡Œæ­£å¸¸"
        // é€šçŸ¥2ï¼štype="warning", title="è­¦å‘Šæ¶ˆæ¯", content="å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜"
        // é€šçŸ¥3ï¼štype="success", title="æˆåŠŸæ¶ˆæ¯", content="ä»»åŠ¡æ‰§è¡Œå®Œæˆ"
        ObjectMapper objectMapper1 =new ObjectMapper();
        String msg1 = objectMapper1.writeValueAsString(new Notification("info", "ç³»ç»Ÿæ¶ˆæ¯", "ç³»ç»Ÿæ­£å¸¸è¿è¡Œ"));
        String msg2 = objectMapper1.writeValueAsString(new Notification("warning", "è­¦å‘Šæ¶ˆæ¯", "å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜"));
        String msg3 = objectMapper1.writeValueAsString(new Notification("success", "æˆåŠŸæ¶ˆæ¯", "ä»»åŠ¡æ‰§è¡Œå®Œæˆ"));

        sseEmitter.send(SseEmitter.event().name("demo").data(msg1));
        sseEmitter.send(SseEmitter.event().name("demo").data(msg2));
        sseEmitter.send(SseEmitter.event().name("demo").data(msg3));


        // æ­¥éª¤3ï¼šå…³é—­è¿æ¥
        sseEmitter.complete();
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹3å®Œæˆ");
        Thread.sleep(100);
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 4ï¼šæµå¼æ¨é€é•¿æ–‡æœ¬ï¼ˆè¿›é˜¶é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 60 ç§’
     * 2. å°†é•¿æ–‡æœ¬é€å­—å‘é€ï¼ˆæ¨¡æ‹Ÿæ‰“å­—æ•ˆæœï¼‰
     * 3. æ–‡æœ¬å†…å®¹ï¼š"è¿™æ˜¯ä¸€ä¸ªæµå¼æ¨é€çš„ç¤ºä¾‹ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä¼šå•ç‹¬å‘é€ï¼Œå°±åƒæ‰“å­—ä¸€æ ·ã€‚"
     * 4. æ¯ä¸ªå­—ç¬¦é—´éš” 100 æ¯«ç§’
     * 5. å‘é€å®Œæˆåå…³é—­è¿æ¥
     * 
     * æç¤ºï¼š
     * - å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„
     * - å¾ªç¯å‘é€æ¯ä¸ªå­—ç¬¦
     */
    @Test
    public void test04_æµå¼æ¨é€é•¿æ–‡æœ¬() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹4ï¼šæµå¼æ¨é€é•¿æ–‡æœ¬ ==========");
        
        String longText = "è¿™æ˜¯ä¸€ä¸ªæµå¼æ¨é€çš„ç¤ºä¾‹ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä¼šå•ç‹¬å‘é€ï¼Œå°±åƒæ‰“å­—ä¸€æ ·ã€‚";
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥
        SseEmitter sseEmitter = new SseEmitter(60000L);
        
        // æ­¥éª¤2ï¼šå°†æ–‡æœ¬é€å­—å‘é€ï¼Œæ¯ä¸ªå­—ç¬¦é—´éš” 100 æ¯«ç§’
        for (int i = 0; i < longText.length(); i++) {

            char key = longText.charAt(i);

            sseEmitter.send(SseEmitter.event()
                    .name("streamText")
                    .data(key)
            );

            log.info(String.valueOf(key));

            Thread.sleep(100);

        }
        
        // æ­¥éª¤3ï¼šå…³é—­è¿æ¥

        sseEmitter.complete();
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹4å®Œæˆ");
        Thread.sleep(100);
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 5ï¼šè®¾ç½®å›è°ƒå‡½æ•°ï¼ˆè¿›é˜¶é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 5 ç§’
     * 2. è®¾ç½®ä¸‰ä¸ªå›è°ƒå‡½æ•°ï¼š
     *    - onCompletionï¼šè¿æ¥å®Œæˆæ—¶æ‰“å° "è¿æ¥å·²å®Œæˆ"
     *    - onTimeoutï¼šè¿æ¥è¶…æ—¶æ—¶æ‰“å° "è¿æ¥å·²è¶…æ—¶"
     *    - onErrorï¼šè¿æ¥å‡ºé”™æ—¶æ‰“å°é”™è¯¯ä¿¡æ¯
     * 3. å‘é€ä¸€æ¡æ¶ˆæ¯ï¼š"è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯"
     * 4. æ­£å¸¸å…³é—­è¿æ¥ï¼ˆä¼šè§¦å‘ onCompletionï¼‰
     * 
     * æç¤ºï¼š
     * - ä½¿ç”¨ emitter.onCompletion()
     * - ä½¿ç”¨ emitter.onTimeout()
     * - ä½¿ç”¨ emitter.onError()
     */
    @Test
    public void test05_è®¾ç½®å›è°ƒå‡½æ•°() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹5ï¼šè®¾ç½®å›è°ƒå‡½æ•° ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥
        SseEmitter sseEmitter  = new SseEmitter(5000L);
        
        // æ­¥éª¤2ï¼šè®¾ç½®ä¸‰ä¸ªå›è°ƒå‡½æ•°

        sseEmitter.onCompletion(
                () -> log.info("å®Œæˆå›è°ƒ")
        );

        sseEmitter.onTimeout(
                () -> log.info("åº”ç”¨è¶…æ—¶")
        );

        sseEmitter.onError(
                (E)-> log.info("åº”ç”¨æŠ¥é”™" + E)
        );
        
        // æ­¥éª¤3ï¼šå‘é€æ¶ˆæ¯
        sseEmitter.send(
                SseEmitter.event().name("demo")
                        .data("ä½ å¥½")
        );
        
        // æ­¥éª¤4ï¼šå…³é—­è¿æ¥ï¼ˆä¼šè§¦å‘ onCompletionï¼‰
        sseEmitter.complete();
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹5å®Œæˆ");
        Thread.sleep(200); // ç­‰å¾…å›è°ƒæ‰§è¡Œ
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 6ï¼šå¤„ç†è¿æ¥è¶…æ—¶ï¼ˆé«˜çº§é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 2 ç§’
     * 2. è®¾ç½®è¶…æ—¶å›è°ƒï¼Œæ‰“å° "è¿æ¥å·²è¶…æ—¶"
     * 3. ç­‰å¾… 3 ç§’ï¼ˆè¶…è¿‡è¶…æ—¶æ—¶é—´ï¼‰
     * 4. å°è¯•å‘é€æ¶ˆæ¯ï¼ˆåº”è¯¥ä¼šå¤±è´¥æˆ–è§¦å‘è¶…æ—¶ï¼‰
     * 
     * æç¤ºï¼š
     * - ä½¿ç”¨ Thread.sleep() ç­‰å¾…
     * - è¶…æ—¶åè¿æ¥ä¼šè‡ªåŠ¨å…³é—­
     */
    @Test
    public void test06_å¤„ç†è¿æ¥è¶…æ—¶() throws InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹6ï¼šå¤„ç†è¿æ¥è¶…æ—¶ ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥ï¼ˆè¶…æ—¶æ—¶é—´ 2 ç§’ï¼‰
        
        // æ­¥éª¤2ï¼šè®¾ç½®è¶…æ—¶å›è°ƒ
        
        // æ­¥éª¤3ï¼šç­‰å¾… 3 ç§’ï¼ˆè¶…è¿‡è¶…æ—¶æ—¶é—´ï¼‰
        
        // æ­¥éª¤4ï¼šå°è¯•å‘é€æ¶ˆæ¯ï¼ˆä½¿ç”¨ try-catch å¤„ç†å¼‚å¸¸ï¼‰
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹6å®Œæˆ");
        Thread.sleep(500); // ç­‰å¾…å›è°ƒæ‰§è¡Œ
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 7ï¼šé”™è¯¯å¤„ç†ï¼ˆé«˜çº§é¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * 1. åˆ›å»ºä¸€ä¸ª SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 10 ç§’
     * 2. è®¾ç½®é”™è¯¯å›è°ƒï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯
     * 3. å‘é€ä¸€æ¡æ¶ˆæ¯
     * 4. æ­£å¸¸å…³é—­è¿æ¥
     * 5. å°è¯•åœ¨å…³é—­åå†æ¬¡å‘é€æ¶ˆæ¯ï¼ˆåº”è¯¥ä¼šå¤±è´¥ï¼‰
     * 6. ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸
     * 
     * æç¤ºï¼š
     * - å…³é—­è¿æ¥åä¸èƒ½å†å‘é€æ¶ˆæ¯
     * - ä½¿ç”¨ try-catch å¤„ç†å¼‚å¸¸
     */
    @Test
    public void test07_é”™è¯¯å¤„ç†() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹7ï¼šé”™è¯¯å¤„ç† ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥
        
        // æ­¥éª¤2ï¼šè®¾ç½®é”™è¯¯å›è°ƒ
        
        // æ­¥éª¤3ï¼šå‘é€ä¸€æ¡æ¶ˆæ¯
        
        // æ­¥éª¤4ï¼šå…³é—­è¿æ¥
        
        // æ­¥éª¤5ï¼šå°è¯•åœ¨å…³é—­åå†æ¬¡å‘é€æ¶ˆæ¯ï¼ˆä½¿ç”¨ try-catchï¼‰
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹7å®Œæˆ");
        Thread.sleep(100);
    }

    // ============================================
    // æµ‹è¯•ç”¨ä¾‹ 8ï¼šç»¼åˆåœºæ™¯ - å®æ—¶ç³»ç»Ÿç›‘æ§ï¼ˆç»¼åˆé¢˜ï¼‰
    // ============================================
    /**
     * éœ€æ±‚ï¼š
     * å®ç°ä¸€ä¸ªå®æ—¶ç³»ç»Ÿç›‘æ§é€šçŸ¥åŠŸèƒ½ï¼š
     * 
     * 1. åˆ›å»º SSE è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´ 60 ç§’
     * 2. è®¾ç½®æ‰€æœ‰å›è°ƒå‡½æ•°ï¼ˆå®Œæˆã€è¶…æ—¶ã€é”™è¯¯ï¼‰
     * 3. å‘é€ç³»ç»Ÿå¯åŠ¨é€šçŸ¥ï¼ˆJSON æ ¼å¼ï¼‰
     * 4. æ¯éš” 1 ç§’å‘é€ä¸€æ¡ç³»ç»ŸçŠ¶æ€æ›´æ–°ï¼ˆå…± 5 æ¡ï¼‰
     *    - çŠ¶æ€åŒ…æ‹¬ï¼šCPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ä½¿ç”¨ç‡
     *    - ä½¿ç”¨ JSON æ ¼å¼
     * 5. å‘é€ç³»ç»Ÿå°±ç»ªé€šçŸ¥ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
     * 6. æ­£å¸¸å…³é—­è¿æ¥
     * 
     * æç¤ºï¼š
     * - åˆ›å»ºä¸€ä¸ª SystemStatus ç±»ï¼ˆå·²æä¾›ï¼‰
     * - ä½¿ç”¨å¾ªç¯å‘é€å¤šæ¡æ¶ˆæ¯
     * - æ¯æ¡æ¶ˆæ¯é—´éš” 1 ç§’
     */
    @Test
    public void test08_ç»¼åˆåœºæ™¯_å®æ—¶ç³»ç»Ÿç›‘æ§() throws IOException, InterruptedException {
        log.info("========== æµ‹è¯•ç”¨ä¾‹8ï¼šç»¼åˆåœºæ™¯ - å®æ—¶ç³»ç»Ÿç›‘æ§ ==========");
        
        // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
        
        // ========== å¼€å§‹ç¼–å†™ä»£ç  ==========
        
        // æ­¥éª¤1ï¼šåˆ›å»º SSE è¿æ¥ï¼ˆè¶…æ—¶æ—¶é—´ 60 ç§’ï¼‰
        
        // æ­¥éª¤2ï¼šè®¾ç½®æ‰€æœ‰å›è°ƒå‡½æ•°
        
        // æ­¥éª¤3ï¼šå‘é€ç³»ç»Ÿå¯åŠ¨é€šçŸ¥ï¼ˆJSON æ ¼å¼ï¼‰
        // Notification: type="system", title="ç³»ç»Ÿå¯åŠ¨", content="ç³»ç»Ÿæ­£åœ¨å¯åŠ¨..."
        
        // æ­¥éª¤4ï¼šæ¯éš” 1 ç§’å‘é€ä¸€æ¡ç³»ç»ŸçŠ¶æ€æ›´æ–°ï¼ˆå…± 5 æ¡ï¼‰
        // ä½¿ç”¨ SystemStatus ç±»ï¼Œæ¨¡æ‹Ÿä¸åŒçš„ CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
        
        // æ­¥éª¤5ï¼šå‘é€ç³»ç»Ÿå°±ç»ªé€šçŸ¥ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
        // "ç³»ç»Ÿç›‘æ§å®Œæˆï¼Œæ‰€æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸"
        
        // æ­¥éª¤6ï¼šå…³é—­è¿æ¥
        
        // ========== ä»£ç ç¼–å†™ç»“æŸ ==========
        
        log.info("âœ… æµ‹è¯•ç”¨ä¾‹8å®Œæˆ");
        Thread.sleep(200);
    }

    // ============================================
    // è¾…åŠ©ç±»ï¼šé€šçŸ¥æ•°æ®æ¨¡å‹
    // ============================================
    static class Notification {
        private String type;
        private String title;
        private String content;
        private Long timestamp;

        public Notification(String type, String title, String content) {
            this.type = type;
            this.title = title;
            this.content = content;
            this.timestamp = System.currentTimeMillis();
        }

        // Getters and Setters
        public String getType() { return type; }
        public void setType(String type) { this.type = type; }
        public String getTitle() { return title; }
        public void setTitle(String title) { this.title = title; }
        public String getContent() { return content; }
        public void setContent(String content) { this.content = content; }
        public Long getTimestamp() { return timestamp; }
        public void setTimestamp(Long timestamp) { this.timestamp = timestamp; }
    }

    // ============================================
    // è¾…åŠ©ç±»ï¼šç³»ç»ŸçŠ¶æ€æ•°æ®æ¨¡å‹
    // ============================================
    static class SystemStatus {
        private Double cpuUsage;
        private Double memoryUsage;
        private Double diskUsage;
        private Long timestamp;

        public SystemStatus(Double cpuUsage, Double memoryUsage, Double diskUsage) {
            this.cpuUsage = cpuUsage;
            this.memoryUsage = memoryUsage;
            this.diskUsage = diskUsage;
            this.timestamp = System.currentTimeMillis();
        }

        // Getters and Setters
        public Double getCpuUsage() { return cpuUsage; }
        public void setCpuUsage(Double cpuUsage) { this.cpuUsage = cpuUsage; }
        public Double getMemoryUsage() { return memoryUsage; }
        public void setMemoryUsage(Double memoryUsage) { this.memoryUsage = memoryUsage; }
        public Double getDiskUsage() { return diskUsage; }
        public void setDiskUsage(Double diskUsage) { this.diskUsage = diskUsage; }
        public Long getTimestamp() { return timestamp; }
        public void setTimestamp(Long timestamp) { this.timestamp = timestamp; }
    }
}

